云际对等协作框架设计

两个角色：云际协调者、云际参与者。

 

**不改变实体云天然异构性，重点解决:**

**1.****异构实体可以识别-->接口转换语言  资源平面**

**2.****异构实体静态关联-->注册磋商匹配  信息平面**

**3.****异构实体动态协作-->生产消费事件  业务平面**

**4.****异构实体可以交互-->请求响应掮客  控制平面**



云际协调者扮演跨独立云服务提供商（超算云、公有云、边缘云、微云）协作的枢纽角色，以智能合约维持协作隐形秩序，为市场中介和监管仲裁的决策输出信息及数字证据。云服务提供商以云际参与者角色在云际协调者的统筹服务下进行对等协作。

当某云际参与者要发起一项协作任务时，其首先充当云际协调者角色，将该任务信息广播给各云际参与者，询问是否参与协作，确定云际参与者名单，开始任务协作。在协作过程中，支持各云际参与者的动态加入与退出以及投入资源数量动态增减。支持云际协调者角色的科学更迭，例如，既可由云际虚拟运营商以代理模式协调，又可由所有云际参与者投票选举出新的云际协调者。

通过设计实现云际对等协作机制（Peer Cooperation Mechanism, PCM），满足各类云际参与者如中心侧、边缘侧和终端侧等异构基础设施资源直接自主参与协作和交易的需求。PCM通过三横一纵四个平面紧密协作，包括横向的业务平面、控制平面和资源平面，以及纵向的信息平面。

**信息平面**不仅纵向穿透三个平面完成内部信息交互，同时也作为PCM框架的对外接口，负责云际协调者与云际参与者之间的通信工作，为磋商协作信息的采集、流入、存储、流出提供通道，为市场中介和监管仲裁的决策输出信息及数字证据。

**业务平面**维护了基于生产者消费者模型的事件队列，当业务平面通过信息平面接收到信息后，生成各类任务事件，并将事件加入队列，待控制平面获取、处理任务并返回结果。业务平面负责各成员之间的事件响应流程及业务事件交互，确保各类业务事件的稳定运行。

**控制平面**主要进行请求响应代理服务，从业务平面的事件队列中读取各类任务并进行响应，具备控制与引导作用。云际协调者的控制平面维护云际参与者信息列表，云际参与者信息列表的更新包含云际参与者名单、各云际参与者资源数量、各云际参与者的任务权重等信息的动态变化和调整，当接收到新增参与者请求时，判断其是否符合资质，若符合则纳入名单中；当收到退出消息时，将相应云际参与者从名单中移除。云际协调者根据云际参与者名单以多样化交互模式（例如、派单、抢单、支持拒单）分发任务。云际参与者的控制平面可对分发的作业任务选择接受或者拒绝，当云际参与者接受任务时，其在云际协调者的参与者名单中权重相应上升，反之则下降，权重将影响云际参与者任务派遣量。任务象征利益，权重会发挥激励作用。

**资源平面**对各类异构基础设施进行定制化的开发与维护，支撑PCM对计算资源进行基础操作，实现各参与者之间的接口代理（API Proxy）及语言转换适配功能。

 

云际协作者与云际参与者简单的交互流程如下：

1）经磋商协作后，确定云际协作者、云际参与者准入策略、结束策略、重选举策略以及云际参与者名单等信息。

2）当云际协作者的业务平面通过信息平面接收到**任务信息**后，将信息封装成事件并纳入事件队列中。

3）云际协作者的控制平面订阅了业务平面的事件队列，当出现事件时进行处理。

4）若事件为作业任务，则进行5）操作，若为新增参与者请求，则10），若为参与者退出消息、参与者动态增减资源消息等，则11）。

5）控制平面对作业任务进行预处理，将其划分为多个子任务并预判各类任务消耗多少资源，根据云际参与者列表中各云际参与者的资源情况以及动态权重，将任务点对点分配给各云际参与者。

6）云际参与者的业务平面通过信息平面接收到信息后，将信息封装成事件并纳入事件队列中。

7）云际参与者的控制平面订阅了业务平面的事件队列，当出现事件时进行判断，若接受该任务，则向云际协作者回复其任务接受信息，否则回复任务拒绝信息，并跳转至9）。

8）云际参与者的控制平面通过资源平面调用基础设施资源，完成任务计算并将结果通过任务平面汇总至信息平面，通过信息平面反馈至云际协作者。

9）云际协作者接收到云际参与者的反馈信息后，根据其接受或拒绝对其权重进行相应增减。对于拒绝的信息，云际协作者的控制平面根据既定规则重新进行分配。

10）云际协作者的控制层面对新增参与者信息的事件进行判断，若符合磋商协作中既定的参与要求，则11），否则返回拒绝参与的信息。

11）云际协作者的控制平面更新参与者名单信息。

当云际协调者、云际参与者在协作过程中，可并行的进行下一任务的磋商握手，待当前轮次满足结束条件后，根据磋商握手结果开启下一轮次的云际对等协作。

![图片3](https://cdn.jsdelivr.net/gh/penghuima/ImageBed@master/img/blog_file/PicGo-Github-ImgBed20220405211616.gif)

PCM-Core与PCM-Edge交互架构

PCM-Core与PCM-Edge交互流程如下：

1）经JCCE磋商握手，达成供需匹配生成传递交易任务,云际协调者（PCM-Core）通过信息平面接收外部任务请求传递至控制平面。

2）云际协调者（PCM-Core）业务平面获取任务消息并封装为任务事件（Event）。

3）云际协调者（PCM-Core）业务平面事件队列中心（EventQueue）获取事件并排序生成生产事件队列（Production event queue）。

4）云际协调者（PCM-Core）控制平面事件处理中心（EventProcessCenter）订阅了业务平面的事件队列，拉取已形成的生产事件队列（Production event queue）。

5）云际协调者（PCM-Core）控制平面当出现事件时，策略中心（PolicyCenter）根据云际参与者的资源储备、作业能力及业务特征，生成协作策略方案。依照方案将事件队列拆解划分处理，如参与者信息列表更新，任务下发等。

6）云际协调者（PCM-Core）控制平面中事件处理中心支持以点对点（P2P）与全局广播（Overall）的形式，将任务处理结果消息传递至信息平面。

7）云际参与者（PCM-Edge）信息平面与云际协调者（PCM-Core）信息平面交互，获取到任务处理结果通知。

8）云际参与者（PCM-Edge）接受任务处理信息，生成任务事件（Event）。

9）云际参与者（PCM-Edge）业务平面事件队列中心（EventQueue）获取事件并排序生成消费事件队列（Consumption event queue）。

10）云际参与者（PCM-Edge）控制平面事件处理中心（EventProcessCenter）订阅了业务平面的事件队列，拉取已形成的消费事件队列（Consumption event queue）。

11）云际参与者（PCM-Edge）控制平面当出现事件时，策略中心（PolicyCenter）根据云际参与者的作业特性及资源使用情况评估任务是否可执行，生成评估反馈结果，更新云际参与者信息列表（JointCloud Participants Information List）。

12）云际参与者（PCM-Edge）控制平面将评估反馈结果至信息平面，并传递给云际协调者（PCM-Core）。

13）云际参与者（PCM-Edge）根据评估反馈结果。若接受任务，由资源平面调配资源，调用接口代理（API Proxy）及语言转换适配，开始执行任务。

14）云际协调者（PCM-Core）收到云际参与者（PCM-Edge）的反馈结果。若拒绝执行任务，协调者根据策略可更新资源平面中的云际参与者信息列表（JointCloud Participants

Information List）对云际参与者名单、各云际参与者资源数量、各云际参与者的任务权重等信息的动态变化和调整，并重新制订协作方案，重复步骤5）至13）。

 

附：设计指导思想

1、简单、一致、适应变化、去除重复

2、简约闭环、简洁架构、富美前端

3、不考虑极端健壮的机制，但需要配套备用的威慑和弥补方案

4、支持超算云、中心云、边缘云和微云等基础设施资源的云际对等协作；

5、云际协调者、云际参与者的角色内涵描述；点出云际协调者不是管理者，后续在设计调度算法时，要突破Master-worker框架。

Mediator / Broker / Coordinator 与 participant

Host 与 Member

 

Master 与 Slave / Worker

Leader 与 Follower

Coordinator有两个作用：常态下市场驱动的磋商、非常态下调解仲裁